---
config:
  theme: dark
  themeVariables:
    primaryColor: '#E3F2FD'
    primaryTextColor: '#0D47A1'
    primaryBorderColor: '#2196F3'
    lineColor: '#1976D2'
    secondaryColor: '#F3E5F5'
    tertiaryColor: '#FFF3E0'
    noteBkgColor: '#FFFDE7'
    noteBorderColor: '#FBC02D'
  layout: elk
---
flowchart TB
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% DEMETERDOCS - ANALYTICS SYSTEM OVERVIEW
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% Purpose: Executive-level view of analytics and reporting system
    %% Scope: Complete flow from user query to exported reports
    %% Detail: High-level only - See subflows for implementation
    %% Updated: 2025-10-08 | Version: 1.0 | Mermaid v11.3.0+
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% LAYER 1: USER ENTRY POINT
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    START@{ shape: stadium, label: "ğŸ“Š User Accesses Analytics
    Web Dashboard
    Role: admin|supervisor|viewer" }

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% LAYER 2: ANALYSIS TYPE SELECTION
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    SELECT_TYPE@{ shape: diamond, label: "Select Analysis Type?" }

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% PATH 1: MANUAL FILTERING
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% Detail: See 01_manual_filters_query.mmd

    subgraph MANUAL_PATH["ğŸ“‹ MANUAL FILTERING PATH"]
        direction TB

        MANUAL_UI@{ shape: rect, label: "Filter Selection UI
        â€¢ Warehouse
        â€¢ Storage Area/Location
        â€¢ Product (family/category)
        â€¢ Packaging
        â€¢ Date Range
        â€¢ State" }

        MANUAL_QUERY@{ shape: cyl, label: "Build SQL Query
        Joins:
        â€¢ warehouses
        â€¢ storage_locations
        â€¢ stock_batches
        â€¢ stock_movements
        â±ï¸ < 500ms" }

        MANUAL_VIZ@{ shape: rect, label: "Generate Visualizations
        â€¢ Bar charts
        â€¢ Line graphs
        â€¢ Pie charts
        â€¢ Tables
        Frontend: Chart.js" }
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% PATH 2: SALES VS STOCK COMPARISON
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% Detail: See 02_sales_vs_stock_comparison.mmd

    subgraph SALES_PATH["ğŸ’° SALES COMPARISON PATH"]
        direction TB

        UPLOAD_CSV@{ shape: subproc, label: "ğŸ“„ Upload Sales CSV
        Format:
        product, packaging, quantity
        Multiple months supported" }

        PARSE_CSV@{ shape: rect, label: "Parse CSV Files
        Validate:
        â€¢ Product exists
        â€¢ Packaging exists
        â€¢ Quantity valid" }

        QUERY_STOCK@{ shape: cyl, label: "Query Latest Active Stock
        SELECT from:
        â€¢ stock_batches (current)
        â€¢ stock_movements
        WHERE active = true" }

        CALC_DIFF@{ shape: rect, label: "Calculate Variance
        estimated_stock =
        current_stock - sales

        Generate report" }

        SALES_VIZ@{ shape: rect, label: "Sales vs Stock Report
        â€¢ Comparison tables
        â€¢ Variance charts
        â€¢ Alerts for discrepancies" }
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% PATH 3: AI-POWERED ANALYTICS
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% Detail: See 03_ai_powered_analytics.mmd

    subgraph AI_PATH["ğŸ¤– AI-POWERED ANALYTICS PATH"]
        direction TB

        AI_INPUT@{ shape: rect, label: "ğŸ’¬ Natural Language Query
        Example:
        'Show mortality by cantero'
        'Compare nave 1 vs 2'" }

        AI_LLM@{ shape: subproc, label: "ğŸ§  LLM Processing
        OpenAI-compatible API
        + Database schema
        + Prompt engineering
        â±ï¸ 2-5s" }

        AI_QUERY@{ shape: cyl, label: "Generate & Execute SQL
        Read-only user
        Query validation
        Timeout: 30s" }

        AI_CODE@{ shape: rect, label: "ğŸ Python Chart Generation
        Libraries:
        â€¢ matplotlib
        â€¢ seaborn
        Output: SVG or data" }

        AI_VIZ@{ shape: rect, label: "AI-Generated Insights
        â€¢ Custom charts
        â€¢ Recommendations
        â€¢ Discovered patterns" }
    end

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% LAYER 3: EXPORT & DELIVERY
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% Detail: See 04_data_export.mmd

    CONSOLIDATE@{ shape: rect, label: "ğŸ“Š Consolidate Results
    Aggregate all visualizations
    Add metadata
    Format for display" }

    DISPLAY@{ shape: rect, label: "ğŸ–¥ï¸ Display in Dashboard
    Interactive charts
    Drill-down capability
    Refresh options" }

    EXPORT_OPTION@{ shape: diamond, label: "Export Data?" }

    EXPORT_FORMAT@{ shape: diamond, label: "Select Format?" }

    EXPORT_EXCEL@{ shape: rect, label: "ğŸ“— Export to Excel
    â€¢ Formatted sheets
    â€¢ Embedded charts
    â€¢ Styling
    Library: openpyxl" }

    EXPORT_CSV@{ shape: rect, label: "ğŸ“„ Export to CSV
    Raw data
    UTF-8 encoding
    Comma delimited" }

    DOWNLOAD@{ shape: stadium, label: "â¬‡ï¸ Download File
    Browser download
    Filename: analytics_YYYYMMDD" }

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% CONNECTIONS
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    START --> SELECT_TYPE

    SELECT_TYPE -->|Manual Filters| MANUAL_UI
    SELECT_TYPE -->|Sales Comparison| UPLOAD_CSV
    SELECT_TYPE -->|AI Analytics| AI_INPUT

    %% Manual path
    MANUAL_UI --> MANUAL_QUERY
    MANUAL_QUERY --> MANUAL_VIZ
    MANUAL_VIZ --> CONSOLIDATE

    %% Sales path
    UPLOAD_CSV --> PARSE_CSV
    PARSE_CSV --> QUERY_STOCK
    QUERY_STOCK --> CALC_DIFF
    CALC_DIFF --> SALES_VIZ
    SALES_VIZ --> CONSOLIDATE

    %% AI path
    AI_INPUT --> AI_LLM
    AI_LLM --> AI_QUERY
    AI_QUERY --> AI_CODE
    AI_CODE --> AI_VIZ
    AI_VIZ --> CONSOLIDATE

    %% Display and export
    CONSOLIDATE --> DISPLAY
    DISPLAY --> EXPORT_OPTION

    EXPORT_OPTION -->|No| DISPLAY
    EXPORT_OPTION -->|Yes| EXPORT_FORMAT

    EXPORT_FORMAT -->|Excel| EXPORT_EXCEL
    EXPORT_FORMAT -->|CSV| EXPORT_CSV

    EXPORT_EXCEL --> DOWNLOAD
    EXPORT_CSV --> DOWNLOAD

    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    %% STYLING
    %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    classDef manualStyle fill:#E3F2FD,stroke:#1976D2,stroke-width:2px
    classDef salesStyle fill:#F3E5F5,stroke:#7B1FA2,stroke-width:2px
    classDef aiStyle fill:#FFF3E0,stroke:#F57C00,stroke-width:2px
    classDef exportStyle fill:#E8F5E9,stroke:#388E3C,stroke-width:2px

    class MANUAL_UI,MANUAL_QUERY,MANUAL_VIZ manualStyle
    class UPLOAD_CSV,PARSE_CSV,QUERY_STOCK,CALC_DIFF,SALES_VIZ salesStyle
    class AI_INPUT,AI_LLM,AI_QUERY,AI_CODE,AI_VIZ aiStyle
    class EXPORT_EXCEL,EXPORT_CSV,DOWNLOAD exportStyle
