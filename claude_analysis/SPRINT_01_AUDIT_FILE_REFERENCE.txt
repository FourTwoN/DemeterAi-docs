================================================================================
SPRINT 01 DATABASE LAYER - FILE REFERENCE GUIDE
================================================================================

MODELS LOCATION:
================================================================================
/home/lucasg/proyectos/DemeterDocs/app/models/

Location Hierarchy Models:
‚úÖ /app/models/warehouse.py                    (DB001 - Root level)
‚úÖ /app/models/storage_area.py                 (DB002 - Level 2)
‚úÖ /app/models/storage_location.py             (DB003 - Level 3/Photo unit)
‚úÖ /app/models/storage_bin.py                  (DB004 - Leaf level)
‚úÖ /app/models/storage_bin_type.py             (DB005 - Bin type catalog)
‚úÖ /app/models/location_relationships.py       (NEW - Spatial relationships)

Product Catalog Models:
‚úÖ /app/models/product_category.py             (DB015 - Root taxonomy)
‚úÖ /app/models/product_family.py               (DB016 - Level 2 taxonomy)
‚úÖ /app/models/product.py                      (DB017 - Leaf products)
‚úÖ /app/models/product_state.py                (DB018 - Lifecycle states)
‚úÖ /app/models/product_size.py                 (DB019 - Size categories)

Packaging Models:
‚úÖ /app/models/packaging_type.py               (Container types)
‚úÖ /app/models/packaging_material.py           (Material types)
‚úÖ /app/models/packaging_color.py              (Color catalog)
‚úÖ /app/models/packaging_catalog.py            (Complete specs)
‚ö†Ô∏è /app/models/price_list.py                   (ISSUE: updated_at type bug)
‚úÖ /app/models/storage_location_config.py      (DB024 - Location config)
‚úÖ /app/models/density_parameter.py            (DB025 - ML density params)

Stock Management Models:
‚úÖ /app/models/stock_batch.py                  (DB007 - Physical stock)
‚úÖ /app/models/stock_movement.py               (DB008 - Stock transactions)

ML Pipeline Models:
‚úÖ /app/models/photo_processing_session.py     (DB012 - Photo processing)
‚úÖ /app/models/classification.py               (DB026 - ML cache)
‚úÖ /app/models/detection.py                    (DB013 - Plant detections)
‚úÖ /app/models/estimation.py                   (DB014 - Dense counting)

Reference & Authentication:
‚úÖ /app/models/product_sample_image.py         (DB020 - Reference images)
‚úÖ /app/models/user.py                         (DB028 - Staff auth)
‚úÖ /app/models/s3_image.py                     (DB011 - S3 metadata)

Model Exports:
üìå /app/models/__init__.py                     (All exports + docstrings)

DATABASE CONFIGURATION:
================================================================================
üìå /app/db/base.py                             (SQLAlchemy declarative base)
üìå /app/db/session.py                          (Async session management)

MIGRATIONS:
================================================================================
/home/lucasg/proyectos/DemeterDocs/alembic/versions/

‚úÖ 6f1b94ebef45_initial_setup_enable_postgis.py
‚úÖ 2f68e3f132f5_create_warehouses_table.py
‚úÖ 742a3bebd3a8_create_storage_areas_table.py
‚úÖ sof6kow8eu3r_create_storage_locations_table.py
‚úÖ 1wgcfiexamud_create_storage_bins_table.py
‚úÖ 2wh7p3r9bm6t_create_storage_bin_types_table.py
‚úÖ 0fc9cac096f2_create_product_categories_table.py
‚úÖ 1a2b3c4d5e6f_create_product_families_table.py
‚úÖ 5gh9j2n4k7lm_create_products_table.py
‚úÖ 3xy8k1m9n4pq_create_product_states_table.py
‚úÖ 4ab9c2d8e5fg_create_product_sizes_table.py
‚úÖ 440n457t9cnp_create_s3_images_table.py
‚úÖ 6kp8m3q9n5rt_create_users_table.py
‚úÖ 8807863f7d8c_add_location_relationships_table.py

‚ö†Ô∏è MISSING: PackagingCatalog, PackagingType, PackagingMaterial, PackagingColor
‚ö†Ô∏è MISSING: StockBatch, StockMovement, PhotoProcessingSession
‚ö†Ô∏è MISSING: Detection, Estimation, Classification
‚ö†Ô∏è MISSING: ProductSampleImage, DensityParameter, StorageLocationConfig, PriceList

DATABASE SCHEMA REFERENCE:
================================================================================
üìå /database/database.mmd                      (ERD - Source of truth)
   - Lines 8-19: Warehouses (DB001)
   - Lines 20-32: StorageAreas (DB002)
   - Lines 33-47: StorageLocations (DB003)
   - Lines 48-58: StorageBins (DB004)
   - Lines 59-74: StorageBinTypes (DB005)
   - Lines 75-96: Product catalog (DB015-017)
   - Lines 97-113: Product states & sizes (DB018-019)
   - Lines 114-144: Packaging (DB009-010, DB021-023)
   - Lines 156-177: StockBatches (DB007)
   - Lines 178-194: StockMovements (DB008)
   - Lines 227-245: S3Images (DB011) [DUPLICATED!]
   - Lines 261-276: Detections (DB013)
   - Lines 277-289: Estimations (DB014)
   - Lines 290-302: Classifications (DB026)
   - Lines 315-327: DensityParameters (DB025)
   - Lines 328-335: LocationRelationships

TESTS:
================================================================================
/home/lucasg/proyectos/DemeterDocs/tests/unit/models/

‚úÖ test_warehouse.py                           (30 tests - PASS)
‚úÖ test_storage_area.py                        (30 tests - PASS)
‚úÖ test_storage_location.py                    (30 tests - PASS/FAIL)
‚úÖ test_storage_bin.py                         (30 tests - PASS)
‚úÖ test_storage_bin_type.py                    (30 tests - PASS)
‚úÖ test_product_category.py                    (28 tests - PASS)
‚úÖ test_product_family.py                      (28 tests - PASS)
‚úÖ test_product.py                             (38 tests - PASS)
‚úÖ test_product_state.py                       (28 tests - ERROR)
‚úÖ test_product_size.py                        (28 tests - ERROR)
‚úÖ test_classification.py                      (42 tests - PASS)
‚úÖ test_detection.py                           (22 tests - ERROR)
‚úÖ test_estimation.py                          (22 tests - ERROR)
‚úÖ test_photo_processing_session.py            (22 tests - ERROR)
‚úÖ test_location_relationships.py              (8 tests - PASS)
‚úÖ test_user.py                                (30 tests - PASS/FAIL)

Test Status Summary:
  - PASS: 294 tests (70%)
  - FAIL: 36 tests (9%) - Mostly intentional relationship checks
  - ERROR: 88 tests (21%) - Database setup failures
  - SKIP: 1 test (<1%)

ARCHITECTURE DOCUMENTATION:
================================================================================
üìå /engineering_plan/03_architecture_overview.md
üìå /engineering_plan/database/README.md
üìå /CLAUDE.md                                  (System instructions)

AUDIT REPORTS:
================================================================================
üìå /SPRINT_01_DATABASE_AUDIT_FINAL.md          (Complete detailed audit)
üìå /SPRINT_01_AUDIT_EXECUTIVE_SUMMARY.txt      (This summary)
üìå /SPRINT_01_AUDIT_FILE_REFERENCE.txt         (This file reference)

KEY FILES TO REVIEW:
================================================================================

For Models Implementation:
1. Start: /app/models/__init__.py             (See all 27 exports)
2. Review: /app/models/warehouse.py           (Best-documented example)
3. Review: /app/models/product.py             (Complex FK patterns)
4. Review: /app/models/s3_image.py            (UUID primary key pattern)

For Database Configuration:
1. Review: /app/db/base.py                    (SQLAlchemy Base)
2. Review: /app/db/session.py                 (Async sessions)

For Migrations:
1. Review: /alembic/versions/2f68e3f132f5_*.py    (warehouse example)
2. Review: /alembic/versions/8807863f7d8c_*.py    (latest - relationships)

For Schema Truth:
1. Source: /database/database.mmd              (ERD - authoritative)

For Tests:
1. Review: /tests/unit/models/test_warehouse.py   (Best examples)
2. Review: /tests/unit/models/conftest.py         (Fixtures)

CRITICAL FILES WITH ISSUES:
================================================================================

‚ö†Ô∏è /app/models/price_list.py
   Issue: updated_at is Date type (should be DateTime)
   Line: 63
   Fix: Change to DateTime type

‚ö†Ô∏è /database/database.mmd
   Issue: S3Image duplicated
   Lines: 227-245 AND 336-352
   Fix: Remove one definition

‚ö†Ô∏è /alembic/versions/ (directory)
   Issue: Missing 14 migration files
   Fix: Generate missing migrations

QUICK COMMANDS:
================================================================================

Test imports:
  cd /home/lucasg/proyectos/DemeterDocs
  python -c "from app.models import *; print('‚úÖ OK')"

Run model tests:
  pytest tests/unit/models/ -v

Run specific model tests:
  pytest tests/unit/models/test_warehouse.py -v

Check coverage:
  pytest tests/unit/models/ --cov=app.models

View migrations:
  ls -la alembic/versions/

Check current migration:
  alembic current

Run migrations:
  alembic upgrade head

CONTACT & ESCALATION:
================================================================================

For Database Questions:
  - Refer to: /database/database.mmd (source of truth)
  - Refer to: /engineering_plan/database/README.md

For Model Implementation Questions:
  - Best example: /app/models/warehouse.py
  - All exports: /app/models/__init__.py

For Migration Issues:
  - Check: /alembic/versions/ directory
  - Read: alembic documentation

For Test Issues:
  - Check: /tests/unit/models/conftest.py (fixtures)
  - Check: /tests/unit/models/test_*.py (examples)

================================================================================
Reference generated: 2025-10-21
